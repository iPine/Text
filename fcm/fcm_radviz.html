<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>fcm_radviz</title>
	<script type="text/javascript" src="lib/d3.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<style type="text/css">
		body{
			width:100%;
			height: 650px;
			margin: 0;
			border:2px solid #ccc;
			font-size: 12px;
			font-family: sans-serif;
		}
		#container{
			height: 100%;
			width: 100%;
			border-top: 1px solid #ccc;
			border-bottom: 1px solid #ccc;
		}
		#tleft{
			position: relative;
			float:left;
			width:25%;
			height: 100%;
			border-right: 1px solid #ccc;
			display:inline-block;

		}
		#tlt {
			margin: 30px;
			height: 120px;
			width: 100%;
			font-size: 17px;
			color: black;
		}
		.control-group{
			margin-top: 15px;
		}
		.clusters_buttons{
	        position: relative;
	        top: 10px;
	        /*left: 5px;*/
      	}
      	.clusters_buttons div{
      		display: inline-block;
	        background-color: skyblue;
	        padding: 3px; 
	        margin: 5px 5px 5px 2px;
	        width: 30px;
	        height: 20px;
	        border: 1px solid black;
	        text-align: center;
      	}

		#tmiddle{
			position: relative;
			float: left;
			width: 50%;
			height: 100%;
			border-right: 1px solid #ccc;
			display:inline-block;
		}
		#radviz{
			margin-left: 5%;
			width: 90%;
			height: auto;
		}
		#tright{
			position: relative;
			float: left;
			width: 20%;
			height: 100%;
			display:inline-block;
			
		}
        #state {
        	margin-top: 100px;
            font-weight: bold;
            font-size: 1.2em;
        }
        .item {
            border: 2px solid white;
            background-color: skyblue;
            opacity: 0.8;
            overflow: visible;
            padding: 6px 0;
            white-space: nowrap;
        }
     

	</style>
</head>
<body>
<script type="text/javascript" src="js/radviz-min.js"></script>

<div id="container">
	<div id="tleft">
		<div id="tlt">
			<div class="control-group" >

			Select the number of clusters:
				
			</div>
		</div>
	</div>
	<div id="tmiddle">
		<div id="radviz"></div>
	</div>
	<div id="tright">
			<div id="state"></div>
	        <div id="list"></div>
	</div>
</div>
<script type="text/javascript">
	 // var dimensions = ['C1', 'C2', 'C3', 'C4','C5','C6','C7','C8','C9',];
	 var cNum = 9;

	 var radvizConfig = {

	 	el: document.querySelector('#radviz'), // container node or selector
        size: 600, 
        margin: 80, // margin around the circular panel, to leave some room for the labels
        dimensions: dimensions(cNum), // data keys to use as dimensions
        colorAccessor: function(d){return d.class;}, // dimension to use for coloring
        colorScale: d3.scale.ordinal().range(['orange', '#de3669', '#52b5f3', 'purple', '#6ab82c',
                '#802A2A', '#58c3e0', 'Â #385E0F', '#e3701e', 'teal',
                '#04389A', 'black']),//d3.scale.category10(), // color palette
        drawLinks: true, 
        zoomFactor: 1, 
        dotRadius: 6, 
        useTooltip: false,
	 }

	var radviz = radvizComponent()
    .config(radvizConfig)
    .on('dotEnter', function(d) {
    	// console.log(d);
                renderList(d);
                
    });
    // .on('dotLeave', function(d) {
    //             // console.log('dotLeave', d);
    // });


    var renderList = function(datum) {

    	var width_scale = d3.scale.linear()
    						.domain([0,1])
    						.range([0,200]);

            d3.select('#state')
            	.text(function(d){
            		return "dot " + (datum.index + 1) + " belongs to " + "cluster " + datum.class;
            	});
          
            var list = d3.select('#list')
                .selectAll('div.item')
                .data(dimensions(cNum));

            list.enter()
            	.append('div')
            	.classed('item', true);

            list.transition()
            	.style({
                    width: function(d) {
                        return width_scale(datum[d]) + 'px';
                    }
                })
                .text(function(d) {
                    return d + ': ' + datum[d];
                });
            list.exit().remove();
        };

    function dimensions(cNum){
	 	 var dimensions = [];
		 for(var i=0; i<cNum; i++){
		 	dimensions.push("C" + (i+1));
		 }
		 return dimensions;
	};

	function maxLabel(data){
    	for(var i=0; i<data.length; i++){

	    	var keys = d3.keys(data[i]);

	    	var max = 0, maxlabel = '';

	    	keys.forEach(function(key){

	    		var num = +data[i][key] + 0.0;

	    		maxlabel = max > num ? maxlabel : key;

	    		 max = max > num ? max : num;

	    	})

	    	data[i].class = maxlabel;
    	}
    };

    function update(cluster_selection){

    	d3.select('#radviz').selectAll('*').remove();
    	d3.select('#state').selectAll('text').remove();
    	d3.select('#list').selectAll('*').remove();

    	
    	if(cluster_selection == 10){
    		cNum = 10;
    		var cluster10 ;
    		d3.csv('data/serum_10.csv',function(err,data){
		    	cluster10 = data;
		    	maxLabel(cluster10);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
		    	.on('dotEnter', function(d) {
                renderList(d);
    			});
	    		radviz.render(cluster10);
    		})	
    	}
    	else if(cluster_selection == 7){
    		cNum = 7;
    		var cluster7 ;
    		d3.csv('data/serum_7.csv',function(err,data){
		    	cluster7 = data;
		    	maxLabel(cluster7);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
    			.on('dotEnter', function(d) {
                renderList(d);
    			});		    	
	    		radviz.render(cluster7);
    		})	
    	}
    	else if(cluster_selection == 8){
    		cNum = 8;
    		var cluster8 ;
    		d3.csv('data/serum_8.csv',function(err,data){
		    	cluster8 = data;
		    	maxLabel(cluster8);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
    			.on('dotEnter', function(d) {
                renderList(d);
    			});		    	
	    		radviz.render(cluster8);
    		})	
    	}
    	else if(cluster_selection == 9){
    		cNum = 9;
    		var cluster9 ;
    		d3.csv('data/serum_9.csv',function(err,data){
		    	cluster9 = data;
		    	maxLabel(cluster9);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
    			.on('dotEnter', function(d) {
                renderList(d);
    			});		    	
	    		radviz.render(cluster9);
    		})	
    	}
    	else if(cluster_selection == 11){
    		cNum = 11;
    		var cluster11 ;
    		d3.csv('data/serum_11.csv',function(err,data){
		    	cluster11 = data;
		    	maxLabel(cluster11);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
    			.on('dotEnter', function(d) {
                renderList(d);
    			});		    	
	    		radviz.render(cluster11);
    		})	
    	}
    	else if(cluster_selection == 12){
    		cNum = 12;
    		var cluster12 ;
    		d3.csv('data/serum_12.csv',function(err,data){
		    	cluster12 = data;
		    	maxLabel(cluster12);
		    	radvizConfig.dimensions = dimensions(cNum);
		    	var radviz = radvizComponent()
    			.config(radvizConfig)
    			.on('dotEnter', function(d) {
                renderList(d);
    			});		    	
	    		radviz.render(cluster12);
    		})	
    	}

    };
    

    var cluster_selection = [7,8,9,10,11,12];

    var buttons = d3.select(".control-group")
    				.append("div")
    				.attr("class","clusters_buttons") 
    				.selectAll("div")
    				.data(cluster_selection)
    				.enter()
    				.append("div")
    				.text(function(d){
    					return d;
    				});

    buttons.on("click",function(d){

    	d3.select(".clusters_buttons")
    		.selectAll("div")
    		.transition()
    		.duration(500)
    		.style('color',"black")
    		.style("background-color","lightBlue");

    	d3.select(this)
    		.transition()
    		.duration(500)
    		.style("color","white")
    		.style("background-color","orange");
    	update(d);
    })

   d3.csv('data/serum_9.csv', function(err,data) {
   		// console.log(data);
    	maxLabel(data);
    	radviz.render(data);
    	
   });
   
</script>
</body>
</html>