<!DOCTYPE html>
<html>
<head>
	<title>donut</title>
	<style type="text/css">
		body {
      font-family: 'Helvetica Neue', Helvetica, sans-serif;
      padding: 10px 20px;
      margin: 0;
    }
    .donut-chart {
      
      font-size: 14px;
      font-weight: 200;
    }

    .donut-chart .value{
      font-size: 0.8em;
      font-weight: 100;
    }
    .chart {
      display: inline-block;
    }
	</style>
</head>
<body>
 <ul>
      <li id="chart1" class="chart"></li>
    </ul>
   <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="js/d3-donut-chart.js"></script>
    <script type="text/javascript">

    
function maxLabel(data){
        for(var i=0; i<data.length; i++){

            var keys = d3.keys(data[i]);

            var max = 0, maxlabel = '';

            keys.forEach(function(key){

                var num = +data[i][key] + 0.0;

                maxlabel = max > num ? maxlabel : key;

                 max = max > num ? max : num;

            })

            data[i].classId = maxlabel;
            data[i].classValue = max;
        }
    }

     function cluster_sum(leaves){
        	// console.log(leaves);
        	// debugger;
	        var total = leaves.length;
	        return {
	        	sum: total,
	        }
    }

    function newData(data){
    	 var nested = d3.nest()
                           .key(function(d) {
                             // debugger;//检查d及d.date
                              return d['classId'];
                           })
                           .rollup(cluster_sum)
                           .entries(data);
        // console.log(nested);

        var dataset = [];
        for(var i=0; i<nested.length; i++){
        	dataset.push([nested[i].key,nested[i].values.sum]);
        }

        return dataset;
    }
    
    	d3.csv("data/iris_4.csv",function(err,data){
        maxLabel(data);
        // console.log(data);
       	var dataset = newData(data);
       
        new DonutChart('#chart1', dataset);


    	})
    </script>
</body>
</html>